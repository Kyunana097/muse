C51 COMPILER V9.60.0.0   IIC                                                               04/29/2025 11:26:34 PAGE 1   


C51 COMPILER V9.60.0.0, COMPILATION OF MODULE IIC
OBJECT MODULE PLACED IN .\Objects\IIC.obj
COMPILER INVOKED BY: D:\keil\C51\BIN\C51.EXE sources\IIC.c LARGE OPTIMIZE(8,SPEED) BROWSE INCDIR(.\Headers;.\sources) DE
                    -BUG OBJECTEXTEND PRINT(.\Listings\IIC.lst) OBJECT(.\Objects\IIC.obj)

line level    source

   1          #include "IIC.h"
   2          
   3          bit ack = 0;
   4          // IIC起始信号
   5          void I2cStart(void) {
   6   1          SCL = 1;
   7   1          SDA = 1;
   8   1          SDA = 0;
   9   1          Delay6us();
  10   1      }
  11          
  12          // IIC停止信号
  13          void I2cStop(void) {
  14   1          SCL = 0;
  15   1          SDA = 0;
  16   1          SCL = 1;
  17   1          Delay6us();
  18   1          SDA = 1;
  19   1          Delay6us();
  20   1      }
  21          
  22          // 读取IIC应答信号
  23          bit I2cReadACK(void) {
  24   1          SCL = 0;
  25   1          SDA = 1; // 释放SDA，准备读取应答信号
  26   1          SCL = 1;
  27   1          Delay6us();
  28   1          ack = SDA;
  29   1          SCL = 0;
  30   1          return ack;
  31   1      }
  32          
  33          // 发送IIC应答信号
  34          void I2cSendAck(bit n) {
  35   1          SCL = 0;
  36   1          SDA = n; // n=1表示不发送应答，n=0表示发送应答
  37   1          SCL = 1;
  38   1          Delay6us();
  39   1          SCL = 0;
  40   1          SDA = 1; // 释放SDA
  41   1      }
  42          
  43          // 发送一个字节数据
  44          void I2cSendByte(unsigned char dat) {
  45   1          unsigned char i;
  46   1          for (i = 0; i < 8; i++) {
  47   2              SCL = 0;
  48   2              if (dat & 0x80) {
  49   3                  SDA = 1;
  50   3              }
  51   2              else {
  52   3                  SDA = 0;
  53   3              }
  54   2              SCL = 1;
C51 COMPILER V9.60.0.0   IIC                                                               04/29/2025 11:26:34 PAGE 2   

  55   2              dat = dat << 1;
  56   2          }
  57   1          SCL = 0;
  58   1          SDA = 1;
  59   1      }
  60          
  61          // 读取一个字节数据
  62          unsigned char I2cReadByte(void) {
  63   1          unsigned char i, dat = 0;
  64   1          SDA = 1; // 释放SDA，准备读取数据
  65   1          for (i = 0; i < 8; i++) {
  66   2              dat = dat << 1;
  67   2              SCL = 0;
  68   2              SCL = 1;
  69   2              if (SDA == 1) {
  70   3                  dat |= 0x01;
  71   3              }
  72   2          }
  73   1          return dat;
  74   1      }
  75          
  76          // 延时函数
  77          void Delay6us(void) {
  78   1          _nop_();
  79   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    130    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =      1       1
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
